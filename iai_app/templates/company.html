{% extends 'base.html' %}
{% block content %}
<section class="company-header">
  <div>
    <h1>{{ name }}</h1>
    <div class="tags">
      {% for tag in tags %}
        <span class="tag">{{ tag }}</span>
      {% else %}
        <span class="tag muted">теги не указаны</span>
      {% endfor %}
    </div>
  </div>
  <div class="iai-badge">IAI {{ '%.1f'|format(iai) }} / 10</div>
</section>

<section class="radar-block">
  <h2>Инвест-радар</h2>
  <div id="radarContainer"
       data-fsi="{{ subindices.get('FSI', {}).get('score', 0) }}"
       data-mpi="{{ subindices.get('MPI', {}).get('score', 0) }}"
       data-pti="{{ subindices.get('PTI', {}).get('score', 0) }}"
       data-tmi="{{ subindices.get('TMI', {}).get('score', 0) }}"
       data-rri="{{ subindices.get('RRI', {}).get('score', 0) }}"
       data-pi="{{ subindices.get('PI', {}).get('score', 0) }}">
    <svg id="radar" viewBox="0 0 320 320"></svg>
  </div>
</section>

<section class="facts-grid">
  <h2>Ключевые факты по субиндексам</h2>
  <div class="grid">
    {% for key, label in {'FSI':'Финансы', 'MPI':'Рынок', 'PTI':'Продукт/Технологии', 'TMI':'Команда/Управление', 'RRI':'Риски', 'PI':'Планы/Исполнение'}.items() %}
      {% set block = subindices.get(key, {}) %}
      <div class="card" data-score="{{ block.get('score', 0) }}">
        <div class="card-header">
          <h3>{{ label }}</h3>
          <span class="score">{{ key }}: {{ '%.1f'|format(block.get('score', 0)) }} / 10</span>
        </div>
        <div class="badge auto"></div>
        <div class="facts">
          {% for fact in block.get('facts', []) %}
            <div class="fact">
              <strong>{{ fact.title }}</strong>
              <p>{{ fact.description }}</p>
              {% if fact.sources %}
                <ul class="sources">
                  {% for src in fact.sources %}
                    <li><a href="{{ src }}" target="_blank" rel="noopener">{{ src }}</a></li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          {% else %}
            <p class="muted">Нет данных.</p>
          {% endfor %}
        </div>
        <div class="progress"><span></span></div>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
