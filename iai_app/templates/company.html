{% extends 'base.html' %}
{% block content %}
<header class="page-hero">
  <div>
    <h1>{{ name }}</h1>
    <div class="tags">
      {% for tag in tags %}
        <span class="tag">{{ tag }}</span>
      {% else %}
        <span class="tag muted">теги не указаны</span>
      {% endfor %}
    </div>
  </div>
  <div class="iai-chip">IAI {{ '%.1f'|format(iai) }} / 10</div>
</header>

<section class="card-pane">
  <div class="pane-head">
    <div class="sub">Инвест‑радар (0–10)</div>
    <div class="sub">FSI · MPI · PTI · TMI · RRI · PI</div>
  </div>
  <div class="radar-wrap">
    <svg id="radar" viewBox="0 0 300 300" aria-label="Радар субиндексов"
         data-fsi="{{ subindices.get('FSI', {}).get('score', 0) }}"
         data-mpi="{{ subindices.get('MPI', {}).get('score', 0) }}"
         data-pti="{{ subindices.get('PTI', {}).get('score', 0) }}"
         data-tmi="{{ subindices.get('TMI', {}).get('score', 0) }}"
         data-rri="{{ subindices.get('RRI', {}).get('score', 0) }}"
         data-pi="{{ subindices.get('PI', {}).get('score', 0) }}">
    </svg>
  </div>
</section>

<section class="facts-section">
  <h2>Ключевые факты (основа оценок)</h2>
  <div class="facts-grid">
    {% for key, label in {'FSI':'Финансы', 'MPI':'Рынок', 'PTI':'Продукт/Технологии', 'TMI':'Команда/Управление', 'RRI':'Риски', 'PI':'Планы/Исполнение'}.items() %}
      {% set block = subindices.get(key, {}) %}
      <article class="fact-card" data-score="{{ block.get('score', 0) }}" data-key="{{ key }}">
        <header>
          <div>
            <p class="sub">{{ key }} — {{ label }}</p>
            <p class="score">{{ key }}: {{ '%.1f'|format(block.get('score', 0)) }} / 10</p>
          </div>
          <span class="badge"></span>
        </header>
        <ul class="fact-list">
          {% for fact in block.get('facts', []) %}
            <li>
              <div class="fact-title">{{ fact.title }}</div>
              <p class="fact-desc">{{ fact.description }}</p>
              {% if fact.sources %}
                <div class="sources">
                  {% for src in fact.sources %}
                    <a href="{{ src }}" target="_blank" rel="noopener">{{ src }}</a>{% if not loop.last %} · {% endif %}
                  {% endfor %}
                </div>
              {% endif %}
            </li>
          {% else %}
            <li class="muted">Нет данных.</li>
          {% endfor %}
        </ul>
      </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
